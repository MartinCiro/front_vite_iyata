import{G as l,H as y,E as P,y as p}from"./index-VqPlM1MX.js";const i=new Map;let f=1e3;function w(){return f++}class m{async getProjects(){try{const s=(await l.get("/posts")).data.slice(0,y.api.limit).map(c=>{const r=i.get(c.id);return r||{id:c.id,title:c.title,description:c.body,status:"active",created_at:new Date().toISOString(),user_id:c.userId}});return[...Array.from(i.values()).filter(c=>c.id>=1e3).filter(c=>!s.some(r=>r.id===c.id)),...s].sort((c,r)=>r.id-c.id)}catch(o){throw o}}async getProject(o){try{const t=i.get(parseInt(o));if(t)return t;const a=(await l.get(`/posts/${o}`)).data;return{id:a.id,title:a.title,description:a.body,status:"active",created_at:new Date().toISOString(),user_id:a.userId}}catch(t){throw t}}async createProject(o){try{const s={id:w(),title:o.title,description:o.description||"",status:o.status||"active",created_at:new Date().toISOString(),user_id:1};return i.set(s.id,s),s}catch(t){throw t}}async updateProject(o,t){try{const s=parseInt(o);s<1e3?await l.put(`/posts/${o}`,{title:t.title,body:t.description||"",userId:1}):console.log("Updating local project in memory:",s);const a=i.get(s)||{},c={id:s,title:t.title,description:t.description||"",status:t.status||"active",created_at:a.created_at||new Date().toISOString(),user_id:1};return i.set(s,c),c}catch(s){throw s}}async deleteProject(o){try{const t=parseInt(o);return t<1e3?await l.delete(`/posts/${o}`):console.log("Deleting local project from memory:",t),i.delete(t),{success:!0}}catch(t){throw t}}async getProjectUsers(){try{return(await l.get("/users")).data.slice(0,3)}catch(o){throw o}}}const u=new m;function I(){const e=P({projects:[],currentProject:null,isLoading:!1,error:null}),o=async()=>{e.isLoading=!0,e.error=null;try{e.projects=await u.getProjects()}catch(r){throw e.error=r.message,r}finally{e.isLoading=!1}},t=async r=>{e.isLoading=!0,e.error=null;try{e.currentProject=await u.getProject(r)}catch(n){throw e.error=n.message,n}finally{e.isLoading=!1}},s=async(r,n)=>{e.isLoading=!0,e.error=null;try{const d=await u.updateProject(r,n),j=e.projects.findIndex(g=>g.id===parseInt(r));return j!==-1&&(e.projects[j]=d),e.currentProject?.id===parseInt(r)&&(e.currentProject=d),d}catch(d){throw e.error=d.message,d}finally{e.isLoading=!1}},a=async r=>{e.isLoading=!0,e.error=null;try{const n=await u.createProject(r);return e.projects.unshift(n),n}catch(n){throw e.error=n.message,n}finally{e.isLoading=!1}},c=async r=>{e.isLoading=!0,e.error=null;try{await u.deleteProject(r),e.projects=e.projects.filter(n=>n.id!==parseInt(r)),e.currentProject?.id===parseInt(r)&&(e.currentProject=null)}catch(n){throw e.error=n.message,n}finally{e.isLoading=!1}};return{projects:p(()=>e.projects),currentProject:p(()=>e.currentProject),isLoading:p(()=>e.isLoading),error:p(()=>e.error),fetchProjects:o,fetchProject:t,createProject:a,updateProject:s,deleteProject:c}}export{I as u};
